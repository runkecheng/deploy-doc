
# XenonDB 高可用测试结果汇总

## 容器故障

| 用例                           |   负载       | 结论                                                                      |
| -----------                    | ----        | -----------                                                               |
| Follower pod MySQL容器故障     |  主节点读写   | 故障从节点MySQL容器重启，重启后重新加入集群，主从结构未改变                   |
| Leader pod MySQL容器故障       |   主节点读写   | 主节点MySQL容器重启，重新选主 |
| Follower pod xenon 故障        |  主节点只读  | 故障从节点xenon容器重启，重启后重新加入集群，主从结构未改变                    |
| Follower pod xenon 故障        |  主节点读写  |   故障从节点xenon容器重启，重新选主                                                                      |
| Leader pod xenon 容器故障      |      主节点读写        |       主节点xenon容器重启，重新选主                                                                     |

## 驱逐pod

| 用例                           | ks配置    |  测试结果                |
| -----------                    |   ----  | ---------------                  |
|  删除一个ks工作节点，导致一个从被驱逐 | 一主三从|该从节点被调度到其他工作节点，主从结构未改变|
|  删除一个ks工作节点，导致主被驱逐 | 一主三从|该主节点降级并被调度到其他工作节点，剩余节点重新选主，原主节点创建完毕后再次重新选主      |
|  删除一个ks工作节点,导致一从被驱逐 | 一主二从| 被驱逐节点无法调度，保持一主一从结构       |
|  删除一个ks工作节点，导致一主被驱逐 |一主二从| 被驱逐节点无法调度，剩余节点选出新主，保持一主一从结构 |
|  删除一个ks工作节点，导致两个从被驱逐 | 一主二从| 被驱逐节点无法调度，集群不可用           |
|  删除一个ks工作节点，导致一主一从被驱逐 | 一主二从| 被驱逐节点无法调度，集群不可用        |

## 扩容

| 用例                             |  操作    |  测试结果                |
| -----------                      |   ----   | ---------------                  |
|        增加pod的副本数量 <br>（仅供测试，不建议执行此操作） |副本数由3增加到5| 新创建的pod无法加入集群，集群结果仍为一主两从      |
|          QKE集群扩容         |基础节点内存由16G增加到32G     | qke出现BUG，暂时无法扩容                                |
|         QKE集群添加节点       |增加一个ks基础节点| pod仍在原来节点，重启后可以被调度到新增的节点  |
|          QKE集群节点重启      |重启ks基础节点 |  重启过程中集群不可用，重启完成后xenondb集群自动重建                            |
|          QKE集群节点重启      |重启ks主节点 |     重启过程中集群不可用，重启完成后恢复，主从结构未改变                            |
|        对绑定的存储扩容       |对主节点绑定的存储扩容 | xenondb集群自动重建  |
|        对绑定的存储扩容       |对从节点绑定的存储扩容 | xenondb集群自动重建  |
